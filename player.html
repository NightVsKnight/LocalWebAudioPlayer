<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Local MP3 Folder Player</title>
<link rel="stylesheet" href="player.css">
</head>
<body>
  <div class="app" role="application" aria-label="Local MP3 Folder Player">
    <header>
      <div>
        <h1>Local MP3 Folder Player</h1>
        <div class="hint">Choose a folder to scan recursively for <strong>.mp3</strong> files (Chromium browsers).</div>
        <div class="folder-path" id="folderPath" aria-live="polite">No folder selected.</div>
      </div>
      <div class="button-group">
        <button class="choose" id="settingsBtn" title="Settings">⚙️ Settings</button>
        <button class="choose" id="chooseBtn">🎵 Choose folder…</button>
      </div>
    </header>

    <div class="wrap">
      <section class="player">
        <div class="top-controls" role="group" aria-label="Top controls">
          <button class="ctrl" id="shuffleBtn" aria-pressed="true" title="Toggle Shuffle (S)">🔀 Shuffle</button>
          <button class="ctrl" id="loopBtn" title="Cycle Loop (L)">🔁 Loop: All</button>
          <button class="ctrl" id="announceBtn" aria-pressed="true" title="Toggle Speech Announcements (A)">🗣 Announce On</button>
        </div>

        <div class="now" role="group" aria-labelledby="nowLabel">
          <small id="nowLabel" class="now-label">Now Playing:</small>
          <span id="nowArtist" class="now-artist">—</span>

          <span id="nowTrackNumber" class="now-num">—</span>
          <span id="nowTitle" class="now-title" aria-live="polite" aria-atomic="true">—</span>
        </div>

        <div class="controls" role="group" aria-label="Playback controls">
          <button class="ctrl" id="prevBtn" title="Previous (Cmd/Ctrl+←)">⏮ Prev</button>
          <button class="ctrl" id="playPauseBtn" title="Space">▶️ Play</button>
          <button class="ctrl" id="nextBtn" title="Next (Cmd/Ctrl+→)">⏭ Next</button>
        </div>

        <div class="seek">
          <input id="seek" type="range" min="0" max="1000" value="0" />
          <div class="time"><span id="tCur">0:00</span> / <span id="tTot">0:00</span></div>
          <div class="now-play-count" id="nowPlayCount" title="Play count">
            <span class="count-icon">▶</span>
            <span class="count-value" id="nowPlayCountValue">—</span>
          </div>
          <div class="now-rating" id="nowRating" title="Rate this track">
            <span class="star" data-rating="1">★</span>
            <span class="star" data-rating="2">★</span>
            <span class="star" data-rating="3">★</span>
            <span class="star" data-rating="4">★</span>
            <span class="star" data-rating="5">★</span>
          </div>
        </div>

        <div class="volume-panel" aria-label="Volume panel">
          <div class="volume-label"><label for="volume" class="hint">Volume</label></div>
          <div class="volume-track"><input id="volume" class="vertical" type="range" min="0" max="100" value="100" title="Volume (↑/↓)" /></div>
          <div class="volume-value" id="volumeDisplay">100%</div>
        </div>

        <div class="visualizer" role="region" aria-label="Audio visualizer">
          <div class="viz-toolbar">
            <span class="viz-title" id="vizTitle">Spectrum Analyzer</span>
            <select id="vizMode" class="viz-select" aria-labelledby="vizTitle">
              <option value="bars">Neon Bars</option>
              <option value="wave">Glow Wave</option>
              <option value="radial">Pulse Halo</option>
            </select>
          </div>
          <canvas id="vizCanvas" class="viz-canvas" role="img" aria-label="Audio visualization"></canvas>
          <div class="viz-status" id="vizStatus">Select a style and start playback to visualize audio.</div>
        </div>
      </section>

      <aside class="list" id="list" aria-label="Playlist"></aside>
    </div>

    <footer>
      <div>Shortcuts: <span class="kbd">Space</span> Play/Pause · <span class="kbd">←/→</span> Seek · <span class="kbd">Cmd/Ctrl+←/→</span> Prev/Next · <span class="kbd">↑/↓</span> Volume · <span class="kbd">S</span> Shuffle · <span class="kbd">L</span> Loop · <span class="kbd">A</span> Announce</div>
      <div class="footer-actions">
        <div id="count">0 tracks</div>
        <button class="history-btn" id="historyToggleBtn" type="button">📜 History</button>
      </div>
    </footer>
  </div>

  <div class="history-overlay" id="historyOverlay" hidden aria-hidden="true">
    <div class="history-sheet" role="dialog" aria-modal="true" aria-labelledby="historyTitle">
      <div class="history-sheet-header">
        <h2 class="history-title" id="historyTitle">Listening History</h2>
        <div class="history-header-actions">
          <span class="history-counter" id="historyCountLabel">0 entries</span>
          <button class="history-clear" id="historyClearBtn" type="button">Clear</button>
          <button class="history-close" id="historyCloseBtn" type="button" aria-label="Close history">×</button>
        </div>
      </div>
      <div class="history-sheet-body">
        <p class="history-empty" id="historyEmptyState">No listening history yet.</p>
        <div class="history-table-wrap hide" id="historyTableWrap">
          <table class="history-table">
            <thead>
              <tr>
                <th scope="col">Started</th>
                <th scope="col">Track</th>
                <th scope="col">Artist • Path</th>
                <th scope="col">Listened</th>
                <th scope="col">% Heard</th>
                <th scope="col">Plays</th>
                <th scope="col">Status</th>
                <th scope="col" aria-label="Actions">Actions</th>
              </tr>
            </thead>
            <tbody id="historyTbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-backdrop" id="settingsModal" role="dialog" aria-labelledby="settingsModalTitle" aria-modal="true">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="settingsModalTitle">Settings</h2>
        <button class="modal-close" id="closeSettingsBtn" aria-label="Close settings">&times;</button>
      </div>
      <div class="modal-body">
        <section class="modal-section">
          <h3 class="modal-section-title">OBS Metadata Export</h3>
          <p class="modal-section-desc">
            Export currently playing track metadata to a text file for use in OBS overlays and streaming software.
            The file updates automatically whenever the track changes.
          </p>
          
          <div class="modal-option">
            <div class="modal-option-label">
              <div class="modal-option-name">Text File Export</div>
              <div class="modal-option-hint">
                Save "Title – Artist" to a text file. Requires Chromium-based browser (Chrome, Edge, Opera).
              </div>
              <div class="modal-option-status" id="textFileStatus">Not configured</div>
            </div>
            <button class="ctrl" id="configureTextFileBtn" style="min-width: 100px;">Configure</button>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <audio id="audio" class="hide" preload="metadata"></audio>

<script src="player.js"></script>
</body>
</html>
